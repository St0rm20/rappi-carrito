<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.Pagination?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Spinner?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>

<StackPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.uniquindio.rappicarrito.controller.ProductosController">

    <BorderPane fx:id="mainContainer" stylesheets="@../styles.css">
        <top>
            <VBox spacing="10" style="-fx-background-color: #f8f9fa; -fx-padding: 15;">

                <HBox alignment="CENTER_LEFT" spacing="20">
                    <Label style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #ff6d00;" text="Rappi Carrito" />

                    <HBox alignment="CENTER_LEFT" spacing="10" HBox.hgrow="ALWAYS">
                        <Label text="ðŸ“ Entrega en:" style="-fx-font-weight: bold;"/>
                        <TextField fx:id="direccionField" promptText="Ej: Calle 123 # 45-67" prefWidth="300"/>
                        <Button onAction="#handleGuardarDireccion" text="Confirmar Dir." style="-fx-background-color: #007bff; -fx-text-fill: white;"/>
                    </HBox>

                    <Button fx:id="carritoButton" onAction="#handleIrAlCarrito" style="-fx-font-size: 14px; -fx-background-color: #28a745; -fx-text-fill: white;" text="ðŸ›’ Ver Carrito" />
                </HBox>

                <HBox alignment="CENTER_LEFT" spacing="15">
                    <VBox spacing="5">
                        <Label text="Filtrar por Nombre:" />
                        <TextField fx:id="filtroNombreField" onKeyReleased="#handleFiltrar" prefWidth="250" promptText="Buscar..." />
                    </VBox>
                    <VBox spacing="5">
                        <Label text="Precio MÃ­n:" />
                        <TextField fx:id="filtroPrecioMinField" onKeyReleased="#handleFiltrar" prefWidth="80" promptText="0" />
                    </VBox>
                    <VBox spacing="5">
                        <Label text="Precio MÃ¡x:" />
                        <TextField fx:id="filtroPrecioMaxField" onKeyReleased="#handleFiltrar" prefWidth="80" promptText="Max" />
                    </VBox>
                    <Button onAction="#handleLimpiarFiltros" text="Limpiar" />
                </HBox>
            </VBox>
        </top>

        <center>
            <VBox spacing="10">
                <Pagination fx:id="pagination" style="-fx-page-information-visible: false;" VBox.vgrow="NEVER" />
                <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS">
                    <GridPane fx:id="productosGrid" hgap="15" style="-fx-padding: 15;" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="20" />
                            <ColumnConstraints percentWidth="20" />
                            <ColumnConstraints percentWidth="20" />
                            <ColumnConstraints percentWidth="20" />
                            <ColumnConstraints percentWidth="20" />
                        </columnConstraints>
                    </GridPane>
                </ScrollPane>
            </VBox>
        </center>
    </BorderPane>

    <StackPane fx:id="modalOverlay" style="-fx-background-color: rgba(0, 0, 0, 0.6);" visible="false">

        <VBox maxHeight="-Infinity" maxWidth="-Infinity"
              prefWidth="900" minHeight="550"
              spacing="20"
              style="-fx-background-color: white; -fx-background-radius: 15; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.5), 20, 0, 0, 0); -fx-padding: 30;">

            <HBox alignment="CENTER_RIGHT" spacing="10">
                <Label fx:id="modalIdLabel" text="ID: 0" style="-fx-text-fill: #aaa; -fx-font-size: 14;" HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                <Button onAction="#cerrarModal" style="-fx-background-color: transparent; -fx-text-fill: #888; -fx-font-weight: bold; -fx-font-size: 20; -fx-cursor: hand;" text="âœ•" />
            </HBox>

            <HBox spacing="40" VBox.vgrow="ALWAYS" alignment="CENTER_LEFT">

                <StackPane style="-fx-border-color: #eee; -fx-border-radius: 10; -fx-padding: 10;">
                    <ImageView fx:id="modalImagen" fitHeight="400" fitWidth="400" preserveRatio="true" />
                </StackPane>

                <VBox spacing="15" HBox.hgrow="ALWAYS" alignment="CENTER_LEFT">

                    <Label fx:id="modalNombre" style="-fx-font-size: 32px; -fx-font-weight: bold; -fx-text-fill: #333;" text="Nombre Producto" wrapText="true" />

                    <Label style="-fx-background-color: #ff6d00; -fx-min-height: 3; -fx-min-width: 50; -fx-max-width: 50;" />

                    <Label text="DescripciÃ³n:" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: #555;"/>
                    <Label fx:id="modalDescripcion" style="-fx-text-fill: #666; -fx-font-size: 16px; -fx-line-spacing: 5;" text="DescripciÃ³n larga..." wrapText="true" VBox.vgrow="ALWAYS" alignment="TOP_LEFT"/>

                    <HBox alignment="BOTTOM_LEFT" spacing="20">
                        <Label fx:id="modalPrecio" style="-fx-font-size: 40px; -fx-text-fill: #2e7d32; -fx-font-weight: bold;" text="\$ 0.00" />
                    </HBox>

                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label text="Disponibles:" style="-fx-text-fill: #888;"/>
                        <Label fx:id="modalStock" style="-fx-font-weight: bold; -fx-text-fill: #333;" text="10" />
                    </HBox>

                </VBox>
            </HBox>

            <HBox alignment="CENTER_RIGHT" spacing="20" style="-fx-padding: 20 0 0 0; -fx-border-color: #eee; -fx-border-width: 1 0 0 0;">

                <Label fx:id="subtotalLabel" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #555;" text="Subtotal: \$0" />

                <HBox spacing="0" style="-fx-border-color: #ccc; -fx-border-radius: 5;">
                    <Button onAction="#handleDecrementarCantidad" text="-" style="-fx-background-color: transparent; -fx-font-size: 16px; -fx-cursor: hand;"/>
                    <Spinner fx:id="cantidadSpinner" editable="true" prefWidth="80" style="-fx-font-size: 16px; -fx-background-color: transparent;"/>
                    <Button onAction="#handleIncrementarCantidad" text="+" style="-fx-background-color: transparent; -fx-font-size: 16px; -fx-cursor: hand;"/>
                </HBox>

                <Button onAction="#handleAnadirAlCarrito"
                        style="-fx-background-color: #ff6d00; -fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 16px; -fx-padding: 10 30; -fx-cursor: hand; -fx-background-radius: 5;"
                        text="AÃ‘ADIR AL CARRITO" />
            </HBox>

        </VBox>
    </StackPane>

</StackPane>